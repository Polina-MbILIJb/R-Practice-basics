---
title: "Лабораторные по R"
author: "С.А.Суязова (Аксюк), [s.aksuk@kiber-guu.ru](mailto:s.aksuk@kiber-guu.ru)"
date: "`r format(Sys.time(), '%d %b, %Y')`"
tags: "R[^1], r-project, RStudio"  
output:
  word_document:
    smart: false 
    reference_docx: ./Шаблон.docx
    toc: yes
---

Ключевые слова: R[^1], r-project, RStudio  

Версия 1.0.0 (2019)  

Примеры выполнены R версии `r paste0(R.version$major, '.', R.version$minor)`, «`r R.version$nickname`».  

Версия RStudio: 1.2.1335.  

Все ссылки действительны на 14 июня 2019 г.  

Репозиторий со скриптами из этой методички: [github.com/aksyuk/labs_r_basics_2019](https://github.com/aksyuk/labs_r_basics_2019)  

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    echo = TRUE,
    comment = "#>",
    collapse = TRUE
)

# функция для форматирования чисел в тексте (2 знака после запятой)
comma <- function(x) {
    format(x, nsmall = 2, digits = 2, big.mark = ' ', decimal.mark = ',')
}
```

## Создание отчёта с помощью пакета «knitr»      

\ \ \ \ \ Установим и включим пакет «knitr»:     

```{r, eval = F}
install.packages('knitr')       # установка
library('knitr')                # загрузка функций в память
```

\ \ \ \ \ Исходный код отчёта необходимо записать в файл RMarkdown с расширением `.Rmd`. В меню RStudio выберем пункт File -> New File -> RMarkdown… В диалоговом окне введём заголовок отчёта (поле «Title»), имя автора («Author») и выберем формат «Word» (Рис. 1).     

![Рис.1. ](./pics/pic-01.png)    

\ \ \ \ \ Новый файл уже содержит готовый пример отчёта (Рис. 2). Основной текст записывается в разметке Markdown. Блоки кода на языке R приводятся в окружении тройных обратных кавычек (буква ё в английской раскладке). Причём вывод кода в тексте отчёта можно отключить, оставив лишь результирующие графики и вывод консоли.     

\ \ \ \ \ Чтобы получить файл «.doc» с отчётом, нужно нажать на кнопку «Knit HTML» над окном редактора кода. При этом файл требуется предварительно сохранить; если этого не было сделано, появится диалоговое окно сохранения. Дадим отчёту имя «report_lab_1-4.Rmd» и сохраним в рабочей директории (расширение нужно указывать явно).     

![Рис.2. ](./pics/pic-02.png)    


## Коротко о языке Markdown     

\ \ \ \ \ **Markdown** – облегчённый язык разметки, созданный с целью написания максимально читабельного и удобного для правки текста, но пригодного для преобразования в языки для продвинутых публикаций [7]. Его синтаксис описан в [7, 8, 9]; последняя ссылка – англоязычный первоисточник от одного из создателей языка.     

\ \ \ \ \ Простые элементы разметки Markdown:     

1.	Один из способов выделить заголовок – поставить символы решётки в начале строки. Количество решёток соответствует уровню заголовка.     

1.	После двойного пробела текст переносится на следующую строку.     

1.	Нумерованные списки обозначаются цифрой и точкой, как в этом списке, только цифрам необязательно идти по порядку. При интерпретации файла список будет пронумерован автоматически.     

1.	Позиции маркированных списков начинаются со звёздочки.     

1.	Для выделения жирным шрифтом текст заключают в двойные звёздочки: **жирный текст**.     

1.	Для выделения курсивом – в одинарные: *курсив*.     

1.	Тройные косые кавычки (буква ё в английской раскладке) обрамляют текст, написанный буквами одной ширины, как в программном коде: ```моноширинный шрифт```.     

1.	Наконец, один из способов написать гиперссылку такой: `[краткий справочник по Markdown] (http://rukeba.com/by-the-way/markdown-sintaksis-po-russki/)/`. Что даст следующий результат: [краткий справочник по Markdown](http://rukeba.com/by-the-way/markdown-sintaksis-po-russki/).     
В RStudio скрипты на R также можно снабжать заголовками по правилам Markdown:     

```
# Заголовок первого уровня --------------------------------

# Заголовок второго уровня ================================

# Заголовок третьего уровня ###############################
```

\ \ \ \ \ После чего легко перемещаться по разделам кода, используя навигатор в нижней части окна редактора скриптов (Рис. 3).     

![Рис.3. ](./pics/pic-03.png)    


## Отчёт по лабораторной №1     

\ \ \ \ \ Теперь изменим отчёт: добавим свой текст, некоторые таблицы и графики из примеров 1, 2. Код скрипта с отчётом можно посмотреть в файле «report_lab_1-4.Rmd».
Обратим внимание на некоторые настройки блоков кода:     

* `warning = F` -- запрет вывода предупреждений в тексте отчёта;     

* `message = F` -- не выводить сообщения о выполнении кода в тексте отчёта;      

* `echo = F` -- сделать блок кода полностью невидимым в отчёте (графики и результаты вывода функций будут видны);     

* `results = 'hide'` -- не показывать результаты вывода функций.     

* `results = 'asis'` -- не форматировать результаты (используется вместе с функциями типа kable(), которые возвращают отформатированный результат).     

\ \ \ \ \ Некоторые из этих параметров можно выставить по умолчанию функцией `opts_current$set()`.     

\ \ \ \ \ Каждому блоку можно дать имя, указав его в заголовке:
`{r <имя блока>}`
`/``

\ \ \ \ \ Тогда в окне редактора кода RStudio будет удобно переключаться между ними, как показано на Рис. 4. Имена блоков можно писать и латиницей, и кириллицей. В самый первый блок кода обычно включают код загрузки пакетов и настройки отчёта и дают ему имя «setup». В меню RStudio «Code» -> «Run Region» есть пункт «Run Setup Chunk», который позволяет при необходимости заново перезапустить общие настройки.     

![Рис.4. ](./pics/pic-04.png)   

\ \ \ \ \ Код R можно включать прямо в строку текста, заключая его в обратные кавычки и указывая в начале язык: «r». Например, выражение `\`r x\`` в тексте при генерации отчёта будет заменено на значение переменной `x`.     

\ \ \ \ \ Стоит упомянуть, что при генерации отчёта все объекты создаются внутри его собственного пространства имён. Поэтому после того, как текст отчёта «связан», объекты и графики не сохраняются в глобальном пространстве имён. Поэтому на этапе отладки бывает полезно запускать весь код отчёта либо его части, не создавая сам файл отчёта. Для этого в «RStudio» удобно пользоваться разделом «Run Region» меню «Code» (Рис. 5):     

- Run Setup Chunk – запустить код блока «setup»;    

- Run All Chunks Above – запустить все блоки выше курсора;     

- Run All Chunks Below – запустить все блоки ниже курсора;     

- Run Current Chunk – запустить блок, в котором стоит курсор;     

- Run Next Chunk – запустить следующий блок после курсора;     

- Run Function Definition – запустить код определения функции;     

- Run All – запустить весь код в отчёте.     

![Рис.5. ](./pics/pic-05.png)   



















